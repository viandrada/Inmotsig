<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition>
	<script type="text/javascript"
		src="http://www.openlayers.org/api/OpenLayers.js">
    </script>

	<div id="mapa" style="width: 90%; height: 600px;"></div>

	<style>
      .olFramedCloudPopupContent {
	    overflow: hidden;
      }
    </style>
	<script type="text/javascript">
	
var wfsTasmaniaRoads; 
var saveStrategy;
saveStrategy = new OpenLayers.Strategy.Save();


wfsTasmaniaRoads = new OpenLayers.Layer.Vector("WFS", {
	  strategies: [new OpenLayers.Strategy.BBOX(),saveStrategy],
	  protocol: new OpenLayers.Protocol.WFS({
	    url: "http://localhost:8080/geoserver/wfs", 
	    featureType: "propiedad",
	    featureNS: "http://www.openplans.org/topp",
	    geometryName: "geom",
	  })
}); 


window.onload = function() {
// esto es por un bug en para wfs
			var _class = OpenLayers.Format.XML;
			var originalWriteFunction = _class.prototype.write;
		
			var patchedWriteFunction = function() {
			    var child = originalWriteFunction.apply( this, arguments );
		
			    // NOTE: Remove the rogue namespaces as one block of text.
			    child = child.replace(new RegExp('xmlns:NS\\d+="" NS\\d+:', 'g'), '');
		
			    return child;
			}
		
			_class.prototype.write = patchedWriteFunction;
// aca termina lo del bug			
			
	
	
	mapa = new OpenLayers.Map("mapa");
/*
	var wmsTasmania=new OpenLayers.Layer.WMS("nada",
					"http://localhost:8080/geoserver/wms", {
				layers : 'tsig_p3:parcelasnuevas',
				transparent: 'false',
				format: 'image/png',
				isBaseLayer: 'true',
				
	});
			*/
	var osm  = new OpenLayers.Layer.OSM();	
	var panel = new OpenLayers.Control.Panel({
                displayClass: "olControlEditingToolbar"
            });
	
	var draw = new OpenLayers.Control.DrawFeature(
		    		wfsTasmaniaRoads, OpenLayers.Handler.Point,
		                {
		                    handlerOptions: {freehand: false, multi: true},
		                    displayClass: "olControlDrawFeaturePoint"
		                    
		                }
	);
		    
	draw.events.register('featureadded',draw ,agregarDatos);
	
	var f;
	function agregarDatos(e){
 		    	f=e.feature;
 		    	
 		    	f.popup = new OpenLayers.Popup.FramedCloud
                ("pop",
                f.geometry.getBounds().getCenterLonLat(),
                null,           
                '<div class="form-group">'+
	'<form class="form-horizontal">'+
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			      '<strong>Datos Propiedad: </strong>'+
		     '</div>'+
		'</div>'+
		
		'<div class="row">'+
		     '<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">'+
				  '<input class="form-control" type="text" id="direccion" name="dir" placeholder="Dirección"></input>'+
		     '</div>'+
		     '<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">'+
				  '<input class="form-control" placeholder="Nro de apto" type="text" id="numAp" name="numApartamento"/>'+
		     '</div>'+
		'</div>'+
		
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			      '<h5>Tipo propiedad:</h5>'+
		     '</div>'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			      '<select id="tipopropiedad" name="tprop" class="form-control">'+
			           '<option value="Casa">Casa</option>'+
				       '<option value="Apartamento">Apartamento</option>'+
				       '<option value="Terreno">Terreno</option>'+
			      '</select>'+
		     '</div>'+
		 '</div>'+
		 
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<h5>Tipo transacción:</h5>'+
			 '</div>'+
			 '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<select id="tipotransaccion" name="ttrans" class="form-control">'+
				    '<option value="Compra">Compra</option>'+
				    '<option value="Alquiler">Alquiler</option>'+
				'</select>'+
			  '</div>'+
		'</div>'+
		
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<h5>Barrio:</h5>'+
			 '</div>'+
			 '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<select id="barrio" name="barr" class="form-control"><option value="Aguada">Aguada</option>'+
				'<option value="BarrioSur">Barrio Sur</option>'+
				'<option value="BellaVista">Bella Vista</option>'+
				'<option value="Buceo">Buceo</option>'+
				'<option value="BrazoOriental">Brazo Oriental</option>'+
				'<option value="Carrasco">Carrasco</option>'+
				'<option value="CarrascoNorte">Carrasco Norte</option>'+
				'<option value="Centro">Centro</option>'+
				'<option value="CiudadVieja">Ciudad Vieja</option>'+
				'<option value="Cordon">Cordon</option>'+
				'<option value="Goes">Goes</option>'+
				'<option value="JacintoVera">Jacinto Vera</option>'+
				'<option value="LaBlanqueada">La Blanqueada</option>'+
				'<option value="LaTeja">La Teja</option>'+
				'<option value="Malvin">Malvin</option>'+
				'<option value="MalvinNorte">Malvín Norte</option>'+
				'<option value="Maronas">Maroñas</option>'+
				'<option value="Palermo">Palermo</option>'+
				'<option value="ParqueBatlle">Parque Batlle</option>'+
				'<option value="ParqueRodo">Parque Rodo</option>'+
				'<option value="Pocitos">Pocitos</option>'+
				'<option value="Prado">Prado</option>'+
				'<option value="PuntaCarretas">Punta Carretas</option>'+
				'<option value="PuntaGorda">Punta Gorda</option>'+
				'<option value="Reducto">Reducto</option>'+
				'<option value="Sayago">Sayago</option>'+
				'<option value="TreCruces">Tres Cruces</option>'+
				'<option value="Union">Unión</option>'+
				'<option value="VillaDelCerro">Villa del Cerro</option>'+
				'</select>'+
			'</div>'+
		'</div>'+
		
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<input class="form-control" type="text" id="precio" name="pre" placeholder="Precio" />'+
			 '</div>'+
			 '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<input class="form-control" type="text" id="tamanio" name="tam" placeholder="Tamaño" />'+
			 '</div>'+
		'</div>'+
		
		'<div class="row">'+
		    '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
		         '<h5>Dormitorios:</h5>'+
		    '</div>'+
		    '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
		         '<select id="dormitorios" name="dor" class="form-control">'+
			         '<option value="0">0</option>'+
				     '<option value="1">1</option>'+
				     '<option value="2">2</option>'+
				     '<option value="3">3</option>'+
				     '<option value="4">4</option>'+
				     '<option value="5">5</option>'+
				     '<option value="6">6</option>'+
				 '</select>'+
			'</div>'+
		'</div>'+
		
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			      '<h5>Baños:</h5>'+
			 '</div>'+
			 '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			      '<select id="banos" name="ban" class="form-control">'+
				      '<option value="0">0</option>'+
				      '<option value="1">1</option>'+
				      '<option value="2">2</option>'+
				      '<option value="3">3</option>'+
				      '<option value="4">4</option>'+
				      '<option value="5">5</option>'+
				   '</select>'+
			 '</div>'+
	    '</div>'+
	    
		'<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
		          '<h5>Garage:</h5>'+
		     '</div>'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				 '<select id="garage" name="gar" class="form-control">'+
				    '<option value="No">No</option>'+
				    '<option value="Si">Si</option></select>'+
			 '</div>'+
		'</div>'+
		
	    '<div class="row">'+
		     '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			     '<h5>Calefacción:</h5>'+
			 '</div>'+
			 '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<select id="calefaccion" name="cale" class="form-control">'+
				     '<option value="No">No</option>'+
				     '<option value="Si">Si</option></select>'+
			 '</div>'+
		'</div>'+
		
		'<div class="row">'+
	        '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
		         '<h5>Parrillero:</h5>'+
		    '</div>'+
		    '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				 '<select id="parrillero" name="parr" class="form-control">'+
				'<option value="No">No</option>'+
				'<option value="Si">Si</option></select>'+
			'</div>'+
		'</div>'+
		
		'<div class="row">'+
		    '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
			     '<h5>Piscina:</h5>'+
			'</div>'+
			'<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<select id="piscina" name="pis" class="form-control">'+
				'<option value="No">No</option>'+
				'<option value="Si">Si</option></select>'+
		     '</div>'+
		'</div>'+
		
		'<div class="row">'+
		    '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
		         '<h5>Estado:</h5>'+
		    '</div>'+
		    '<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">'+
				'<select id="estado" name="est" class="form-control">'+
				'<option value="Privada">Privada</option>'+
				'<option value="Publica">Publica</option></select>'+
			'</div>'+
		'</div>'+
		
		'<div class="row">'+
		    '<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">'+
			    '<textarea type="text" id="descripcion" name="des" rows="2" placeholder="Descripción" class="form-control"/>'+
			'</div>'+
		'</div>'+
	'</form>'+
'</div>',
                null,
                true 
                );
             mapa.addPopup(f.popup); 

	};
		  
	var attributes = {direccion: "magallanes"};
	var select = new OpenLayers.Control.SelectFeature(wfsTasmaniaRoads);
    mapa.addControl(select);
    select.activate();
            		
    function onPopupClose(evt) {
            			selectControl.unselect(selectedFeature);
    };
		            
	wfsTasmaniaRoads.events.on({
	            	featureselected: function(event) {
	                var feature = event.feature;
	                   feature.popup = new OpenLayers.Popup.FramedCloud
	                   ("pop",
	                   feature.geometry.getBounds().getCenterLonLat(),
	                   null,
	                   '<form >Direccion:<br/><input type="text" id="direccion2" value="'+feature.attributes.direccion+'" name="dir" />'+
	                   '<br/>Numero de apartamento:<br/><input type="text" id="numAp2" value="'+feature.attributes.numapartam+'" name="numApartamento" />'+
	                   '<br/>Tipo de propiedad:<br/><input type="text" id="tipopropiedad2" value="'+feature.attributes.tipoinmueb+'" name="tprop" />'+ 
	                   '<br/>Tipo de transaccion:<br/><input type="text" id="tipotransaccion2" value="'+feature.attributes.tipooperac+'" name="ttrans" />'+
	                   '<br/>Precio:<br/><input type="text" id="precio2" value="'+feature.attributes.precio+'" name="pre" />'+
	                   '<br/>Dormitorios:<br/><input type="text" id="dormitorios2" value="'+feature.attributes.cantdormit+'" name="dor" />'+
	                   '<br/>Garage:<br/><input type="text" id="garage2" value="'+feature.attributes.garage+'" name="gar" />'+
	                   '<br/>Tamanio:<br/><input type="text" id="tamanio2" value="'+feature.attributes.tamano+'" name="tam" />'+
	                   '<br/>Barrios:<br/><input type="text" id="barrio2" value="'+feature.attributes.barrio+'" name="barr" />'+
	                   '<br/>Banos:<br/><input type="text" id="banos2" value="'+feature.attributes.banos+'" name="ban" />'+
	                   '<br/>Calefaccion:<br/><input type="text" id="calefaccion2" value="'+feature.attributes.calefaccion+'" name="cale" />'+
	                   '<br/>Parrillero:<br/><input type="text" id="parrillero2" value="'+feature.attributes.parillero+'" name="parr" />'+
	                   '<br/>Piscina:<br/><input type="text" id="piscina2" value="'+feature.attributes.piscina+'" name="pis" />'+
	                   '<br/>Estado:<br/><input type="text" id="estado2" value="'+feature.attributes.estado+'" name="est" />'+
	                   '<br/>Descripcion:<br/><input type="text" id="descripcion2" value="'+feature.attributes.descripcion+'" name="des" /></form>',
	                   null,
	                   true 
	                   );
	                mapa.addPopup(feature.popup);  
	                },

		                <!-- destroy popup when feature is no longer selected. Prevents showing 2 Popups at the same time-->
			     	featureunselected: function(event) {
		                    var feature = event.feature;
		                    mapa.removePopup(feature.popup);
		                    feature.popup.destroy();
		                    feature.popup = null;
		            }
		         
	});
		            

	var save=  new OpenLayers.Control.Button({displayClass: 'saveButton',
	   	   trigger: function() {
	   		 		f.attributes.adminid="1" //SETEAR ADMIN
		   	   		f.attributes.direccion=document.getElementById("direccion").value;
		   	   		f.attributes.numapartam=parseInt(document.getElementById("numAp").value);
		   	   	    f.attributes.gidpadron=1234; //SETEAR PADRON
		   	   	    f.attributes.tipoinmueb=document.getElementById("tipopropiedad").value;
		   	    	f.attributes.tipooperac=document.getElementById("tipotransaccion").value;
		   	    	f.attributes.precio=parseInt(document.getElementById("precio").value);
		   	    	f.attributes.cantdormit=parseInt(document.getElementById("dormitorios").value);
		   	    	f.attributes.garage=document.getElementById("garage").value;
		   	    	f.attributes.tamano=parseInt(document.getElementById("tamanio").value);
		   	    	f.attributes.barrio=document.getElementById("barrio").value;
		   	    	f.attributes.banos=parseInt(document.getElementById("banos").value);
		   	    	f.attributes.calefaccio=document.getElementById("calefaccion").value;
		   	    	f.attributes.parillero=document.getElementById("parrillero").value;
		   	    	f.attributes.piscina=document.getElementById("piscina").value;
		   	    	f.attributes.estado=document.getElementById("estado").value;
		   	    	f.attributes.descripcio=document.getElementById("descripcion").value;
		   	    	//SETEAR IMAGEN
		   	    	
		    	   		saveStrategy.save();
		    	   		mapa.removePopup(f.popup);
		                f.popup.destroy();
		                f.popup = null;
		    	   		}, title: 'Save changes' 
		    	 });
		       
		       
	panel.addControls([select,draw,save]);
	mapa.addControl(panel);  
 			
			
	//mapa.addLayer(wmsTasmania);			
	mapa.addLayer(osm);
	var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
    var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
    var position       = new OpenLayers.LonLat(-56.21,-34.81).transform( fromProjection, toProjection);
  	mapa.addLayer(wfsTasmaniaRoads);
  	mapa.zoomToMaxExtent();
  	var lonlat = new OpenLayers.LonLat(-56.21,-34.81).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:32721"));
	mapa.setCenter(position,12);
	
	mapa.addControl(new OpenLayers.Control.LayerSwitcher(true));
	mapa.addControl(new OpenLayers.Control.MousePosition({ numDigits: 6 }));
	mapa.addControl(new OpenLayers.Control.ScaleLine());

     
	}

</script>

</ui:composition>
</html>